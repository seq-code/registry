<% if @name.taxonomic_data? || @name.can_edit?(current_user) %>
  <dl name="taxonomy" class="main-section name-details">
    <h2>Taxonomy</h2>

    <% if @name.description? || @name.can_edit?(current_user) %>
      <dt><%= fa_icon('file-alt') %> Description</dt>
      <dd>
        <%= @name.description %>
        <% if @name.can_edit?(current_user) %>
          <%= link_to(
                edit_name_url(@name),
                class: 'badge badge-pill badge-info',
                title: 'edit description'
              ) do %>
            <%= fa_icon('edit') %> Edit
          <% end %>
        <% end %>
      </dd>
    <% end %>

    <% if @name.notes? || @name.can_edit?(current_user) %>
      <dt><%= fa_icon('sticky-note') %> Notes</dt>
      <dd>
        <%= @name.notes %>
        <% if @name.can_edit?(current_user) %>
          <%= link_to(
                edit_notes_name_url(@name),
                class: 'badge badge-pill badge-info',
                title: 'edit notes'
              ) do %>
            <%= fa_icon 'edit' %> Edit
          <% end %>
        <% end %>
      </dd>
    <% end %>

    <% if @name.parent %>
      <dt><%= fa_icon('layer-group') %> Classification</dt>
      <dd><%= name_lineage(@name) %></dd>
    <% end %>

    <% if @name.parent || @name.incertae_sedis? || @name.can_edit?(current_user) %>
      <dt><%= fa_icon('sort-amount-up-alt') %> Parent</dt>
      <dd>
        <% if @name.incertae_sedis? %>
          <div class="border-left px-3">
            <b><%= @name.incertae_sedis_html %>:</b>
            <%= @name.incertae_sedis_text %>
          </div>
        <% elsif @name.parent %>
          <%= link_to_name(@name.parent) %>
        <% end %>

        <% if @name.can_edit?(current_user) %>
          <%= link_to(
                link_parent_name_path(@name),
                class: 'badge badge-pill badge-info',
                title: 'edit parent'
              ) do %>
            <%= fa_icon 'edit' %> Edit
          <% end %>
        <% end %>
      </dd>
    <% end %>

    <% if @name.assigned_by %>
      <dt><%= fa_icon('arrow-alt-circle-up') %> Assigned by</dt>
      <dd>
        <%= link_to(@name.assigned_by.short_citation, @name.assigned_by) %>
        <% if @name.can_edit?(current_user) %>
          <%= link_to assigned_by_name_url(@name, @name.assigned_by, not: true),
                method: :post, class: 'badge badge-pill badge-info',
                title: 'Did not assign this name taxonomically',
                data: { confirm: 'Are you sure?' } do %>
            <%= fa_icon('unlink') %> Unlink
          <% end %>
        <% end %>
      </dd>
    <% end %>

    <% unless @name.children.empty? %>
      <dt><%= fa_icon('sort-amount-down-alt') %> Children
          <span class="text-muted">(<%= @name.children.count %>)</span><dt>
      <dd><ul class='pl-3'>
        <%
          set_type = @name.can_edit?(current_user) && @name.rank? &&
                     %w[genus family].include?(@name.rank)
        %>
        <% @name.children.each do |child| %>
          <li>
            <%= link_to(child.name_html, child) %>
            <% if set_type && @name.type_accession.to_i != child.id %>
              <%= link_to(
                    name_url(
                      @name,
                      name: { type_material: :name, type_accession: child.id }
                    ),
                    method: :patch,
                    class: 'badge badge-pill badge-info',
                    data: { confirm: 'Are you sure?' }
                  ) do %>
                <%= fa_icon 'clipboard-check' %> Set as type
              <% end %>
            <% end %>
          </li>
        <% end %>
      </ul></dd>
    <% end %>

    <% if @name.taxonomic_status? %>
      <dt><%= fa_icon('clipboard-check') %> Taxonomic status</dt>
      <dd><%= @name.taxonomic_status.upcase_first %></dd>
    <% end %>

    <% if @name.correct_name %>
      <dt><%= fa_icon('spell-check') %> Correct name</dt>
      <dd><%= link_to_name(@name.correct_name) %></dd>
    <% end %>

    <% if @name.synonyms.present? %>
      <dt><%= fa_icon('exchange-alt') %> Synonyms</dt>
      <dd><ul>
        <% @name.synonyms.each do |synonym| %>
          <li><%= link_to_name(synonym) %></li>
        <% end %>
      </ul></dd>
    <% end %>
  </dl>
<% end %>
