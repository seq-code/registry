<% if !@name.validated? && !@name.qc_warnings.empty? %>
  <dl name="quality-checks" class="main-section name-details border-danger" style="border-left: 1em solid;">
    <h2>Failed Quality Checks</h2>
    <% @name.qc_warnings.each do |warn| %>
      <dt>
        <%
          blocking = warn[:fail] == :error
          icon_class = blocking ? 'text-danger' : 'text-warning'
        %>
        <%= fa_icon('exclamation-triangle', class: icon_class) %>
        <%= warn[:type].to_s.gsub(/_/, ' ').capitalize %>
      </dt>
      <dd class="pt-2">
        <%= warn[:message] %>
        <% if warn[:link_public] || @name.can_edit?(current_user) %>
          <%= link_to(warn[:link_to], class: 'text-danger') do %>
            [<%= warn[:link_text] %>]
          <% end %>
        <% end %>
        <% if warn[:rules] || warn[:recommendations] || warn[:rule_notes] %>
          <div class="text-muted">
            <b>ยง Contravenes SeqCode</b>:
            <% unless warn[:rules].blank? %>
              <%= warn[:rules].size == 1 ? 'Rule' : 'Rules' %>
              <%=
                warn[:rules]
                  .map { |i| link_to_rule(i) }.to_sentence.html_safe
              %>
              <%=
                warn[:recommendations] && warn[:rule_notes] ?
                  ',' : warn[:recommendations] || warn[:rule_notes] ? 'and' : ''
              %>
            <% end %>
            <% unless warn[:rule_notes].blank? %>
              <%= warn[:rule_notes].size == 1 ? 'Note to Rule' : 'Notes to Rules' %>
              <%=
                warn[:rule_notes]
                  .map { |i| link_to_rule(i) }.to_sentence.html_safe
              %>
              <%= 'and' if warn[:recommendations] %>
            <% end %>
            <% unless warn[:recommendations].blank? %>
              <%= warn[:recommendations].size == 1 ? 'Recommendation' : 'Recommendations' %>
              <%=
                warn[:recommendations]
                  .map { |i| link_to_recommendation(i) }.to_sentence.html_safe
              %>
            <% end %>
            <% unless warn[:can_approve].blank? || @name.validated? %>
              but can be safely ignored before validation
            <% end %>
          </div>
        <% end %>
      </dd>
    <% end %>
    </dd>
  </dl>
<% elsif !@name.validated? %>
  <dl class="main-section name-details border-success py-3" style="border-left: 1em solid;">
    <h4 class="text-success">
      <%= fa_icon('check-circle') %>&nbsp;
      All automated quality checks passed
    </h4>
  </dl>
<% end %>

<% if @name.queued_for_external_resources %>
  <div class="alert alert-warning">
    External resources are currently being queried to determine potential
    homologies across nomenclatural codes
  </div>
<% end %>
