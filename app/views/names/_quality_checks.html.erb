<% if @name.can_edit?(current_user) %>
  <% if !@name.validated? && !@name.qc_warnings.empty? %>
    <dl name="quality-checks"
        class="main-section name-details border-danger"
        style="border-left: 1em solid;">
      <h2>Failed Quality Checks</h2>
      <% @name.qc_warnings.each do |warn| %>
        <dt>
          <%
            blocking = warn.fail == :error
            icon_class = blocking ? 'text-danger' : 'text-warning'
          %>
          <%= fa_icon('exclamation-triangle', class: icon_class) %>
          <%= warn.title %>
        </dt>
        <dd class="pt-2">
          <%= warn[:message] %>
          <% if warn.link_to %>
            <% if warn.link_public || @name.can_edit?(current_user) %>
              <%= link_to(warn.link_to, class: 'text-danger') do %>
                [<%= warn.link_text %>]
              <% end %>
            <% end %>
          <% end %>
          <% if warn[:rules] || warn[:recommendations] || warn[:rule_notes] %>
            <div class="text-muted">
              <b>ยง Contravenes SeqCode</b>:
                <% comma = false %>
                <% %w[rule rule_note recommendation].each do |section| %>
                  <% warn[:"#{section}s"]&.each do |i| %>
                    <% text = name_of_seqcode_section(section, i) %>
                    <%= ' โข ' if comma %>
                    <%= link_to_seqcode_excerpt(section, i, text) %>
                    <% comma = true %>
                  <% end %>
                <% end %>
            </div>
          <% end %>
          <% if warn.check %>
            <div class="text-muted">
              Identified by <%= link_to_user(warn.check.user) %>
              <%= time_ago_in_words(warn.check.updated_at) %> ago
            </div>
          <% end %>
        </dd>
      <% end %>
      </dd>
    </dl>
  <% elsif !@name.validated? %>
    <dl class="main-section name-details border-success py-3"
        style="border-left: 1em solid;">
      <h4 class="text-success">
        <%= fa_icon('check-circle') %>&nbsp;
        All automated quality checks passed
      </h4>
    </dl>
  <% end %>

  <% if @name.queued_for_external_resources %>
    <div class="alert alert-warning">
      External resources are currently being queried to determine potential
      homonymies across nomenclatural codes
    </div>
  <% end %>
<% end %>
