<% if current_curator? && !@name.validated? %>
  <% if !@name.qc_warnings.checks.empty? %>
    <div>
      <%= link_to('#curator-checklist',
                  class: 'btn btn-primary btn-curator-checklist',
                  aria: { expanded: 'false', controls: 'curator-checklist' },
                  role: 'button', data: { toggle: 'collapse' }) do %>
        <h2 class="ml-4 my-1">
          <%= fa_icon('tasks') %>
          Manual Curation Checklist
        </h2>
      <% end %>
    </div>
    <dl class="main-section name-details curator-checklist collapse border-primary"
        id="curator-checklist" style="border-left: 1em solid;">
      <% @name.qc_warnings.checks.each do |warn| %>
        <%
          warn_class =
            if !warn.check
              'check-skip'
            elsif warn.check.pass
              'check-pass'
            else
              'check-fail'
            end
        %>
        <dt class="<%= warn_class %>">
          <span class="check-links">
            <%= link_to('#', title: 'Skip',
                        data: { do: 'skip', kind: warn.type }) do %>
              <%= fa_icon('minus-circle') %>
            <% end %>
            <%= link_to('#', title: 'Pass',
                        data: { do: 'pass', kind: warn.type }) do %>
              <%= fa_icon('check-circle') %>
            <% end %>
            <%= link_to('#', title: 'Fail',
                        data: { do: 'fail', kind: warn.type }) do %>
              <%= fa_icon('exclamation-circle') %>
            <% end %>
          </span>
          <span>
            <%= warn[:checklist].to_s.capitalize %> &raquo;
            <%= warn.title %>
          </span>
        </dt>
        <dd class="pb-2">
          <% if warn[:rules] || warn[:recommendations] || warn[:rule_notes] %>
            <%= warn[:message] %>
            <div class="text-muted">
              <b>ยง SeqCode</b>:
                <% %w[rule rule_note recommendation].each do |section| %>
                  <% warn[:"#{section}s"]&.each do |i| %>
                    โข
                    <% text = name_of_seqcode_section(section, i) %>
                    <%= link_to_seqcode_excerpt(section, i, text) %>
                  <% end %>
                <% end %>
            </div>
          <% end %>
        </dd>
      <% end %>
      </dd>
    </dl>
    <script>
      $('.curator-checklist .check-links a[data-do]').on("click",
        function() {
          var path = "<%= check_path(@name) %>";
          var data = $(this).data();
          var dt = $(this).parent().parent();
          dt.addClass("bg-warning");

          $.post(path, data, function(res) {
            dt.removeClass();
            dt.addClass("check-" + data["do"]);
          })
          .fail(function(res) {
            alert(res["responseText"]);
          })
          .always(function() {
            dt.removeClass("bg-warning");
          });

          return(false);
        }
      );
    </script>
    <br/>
  <% end %>
<% end %>
