<dl name="metadata" class="main-section name-details">
  <h2>Metadata</h2>

  <% if @name.links? %>
    <dt><%= fa_icon('link') %> Outside links and data sources</dt>
    <dd>
      <ul>
        <% if @name.ncbi_taxonomy? %>
          <li>
            <%= link_to(@name.ncbi_taxonomy_url, target: '_blank') do %>
              NCBI Taxonomy: <%= @name.ncbi_taxonomy %>
              <%= fa_icon('external-link-alt') %>
            <% end %>
          </li>
        <% end %>

        <% if @name.gtdb_genome? %>
          <li>
            <%= link_to(@name.gtdb_genome_url, target: '_blank') do %>
              GTDB Genome: <%= @name.type_accession %>
              <%= fa_icon('external-link-alt') %>
            <% end %>
          </li>
        <% end %>

        <% gbif = @name.gbif_homonyms(false, true) %>
        <% if gbif.present? %>
          <% id = modal('GBIF Links') do %>
            <ul>
              <% gbif.each do |link| %>
                <li>
                  <%= link.html_safe %>
                  <%= fa_icon('external-link-alt') %>
                </li>
              <% end %>
            </ul>
            <div class="text-muted border-top pt-2">
              Retrieved <%= time_ago_in_words(@name.gbif_at) %> ago
            </div>
          <% end %>
          <li>
            <%= modal_button(id, as_anchor: true) do %>
              Global Biodiversity Information Facility (GBIF)
            <% end %>
          </li>
        <% end %>

        <% if @name.lpsn_url? %>
          <li>
            <%= link_to(@name.lpsn_url, target: '_blank') do %>
              List of Prokaryotic names with Standing in Nomenclature (LPSN)
              <%= fa_icon('external-link-alt') %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </dd>
  <% end %>

  <dt><%= fa_icon(:dna) %> Search sequences</dt>
  <dd>
    <ul>
      <li>
        <%= link_to(@name.ncbi_search_url, target: '_blank') do %>
          NCBI Nucleotide
          <%= fa_icon('external-link-alt') %>
        <% end %>
      </li>
      <% if @name.ncbi_taxonomy? %>
        <li>
          <%= link_to(@name.ncbi_genomes_url, target: '_blank') do %>
            NCBI Genomes
            <%= fa_icon 'external-link-alt' %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </dd>

  <dt><%= fa_icon 'calendar' %> Local history</dt>
  <dd>
    <ul>
      <% if @name.created_at == @name.updated_at %>
        <li>This name has not been modified since creation</li>
      <% else %>
        <li>
          This name was last modified
          <u class="hover-help"
             title="<%= @name.updated_at %>"
             ><%= time_ago_in_words(@name.updated_at) %> ago</u>
        </li>
      <% end %>
      <% if @workflow_modal_id ||= nil %>
        <li>
          <%= modal_button(@workflow_modal_id, as_anchor: true) do %>
            Current workflow status
          <% end %>
        </li>
      <% end %>
      <% if @name.validated? %>
        <li>
          <% id = modal('Quality Checks', size: 'xl') do %>
            <%= render(partial: 'quality_checks',
                       locals: { force_qc_view: true }) %>
          <% end %>
          <%= modal_button(id, as_anchor: true) do %>
            Quality checks before valid publication
          <% end %>
        </li>
      <% end %>
      <% if current_curator? %>
        <li>
          <% id = modal('Users with alerts') do %>
            <ul>
              <% @name.observers.each do |user| %>
                <li><%= display_link(user) %></li>
              <% end %>
            </ul>
          <% end %>
          <%= modal_button(id, as_anchor: true) do %>
            Users with active alerts (only visible to curators)
          <% end %>
        </li>
      <% end %>
    </ul>
  </dd>

  <dt><%= fa_icon('user') %> Registered by</dt>
  <dd>
    <% if @name.created_by %>
      <%= link_to(@name.created_by.username, @name.created_by) %>
    <% else %>
      Excubia Bot
    <% end %>
    <u class="hover-help"
       title="<%= @name.created_at %>"
       ><%= time_ago_in_words(@name.created_at) %> ago</u>
  </dd>

  <% if @name.submitted_by %>
    <dt><%= fa_icon('paper-plane') %> Submitted by</dt>
    <dd>
      <%= link_to(@name.submitted_by.username, @name.submitted_by) %>
      <u class="hover-help"
         title="<%= @name.submitted_at %>"
         ><%= time_ago_in_words(@name.submitted_at) %> ago</u>
       <% unless @name.after_submission? %>
         (returned by curator)
       <% end %>
    </dd>
  <% end %>

  <% if @name.after_endorsement? && @name.endorsed_by %>
    <dt><%= fa_icon('check-square') %> Endorsed by</dt>
    <dd>
      <%= link_to(@name.endorsed_by.username, @name.endorsed_by) %>
      <u class="hover-help"
         title="<%= @name.endorsed_at %>"
         ><%= time_ago_in_words(@name.endorsed_at) %> ago</u>
    </dd>
  <% end %>

  <% if @name.valid? && @name.validated_by %>
    <% if @name.status == 15 %>
      <dt><%= fa_icon('certificate') %> Validated by</dt>
    <% else %>
      <dt><%= fa_icon('stamp') %> Reported valid by</dt>
    <% end %>
    <dd>
      <%= link_to(@name.validated_by.username, @name.validated_by) %>
      <u class="hover-help"
         title="<%= @name.validated_at %>"
         ><%= time_ago_in_words(@name.validated_at) %> ago</u>
    </dd>
  <% end %>
</dl>
