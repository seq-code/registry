<script>
  $('.curator-checklist .check-links a[data-do]').on("click",
    function() {
      var data = $(this).data();
      var pattern = "<%= check_path('{name}', format: :json) %>";
      var path = pattern.replace('{name}', data["name"]);
      var dt = $(this).parent().parent();
      dt.addClass("bg-warning");

      $.post(path, data, function(res) {
        dt.removeClass();
        dt.addClass("check-" + data["do"]);
        var mcp = $('#manual-curation-percent');
        if (mcp.length) {
          var unchecked = $('#curator-checklist .check-skip').length;
          var total = mcp.data("total");
          var perc = Math.round(100 * (total - unchecked) / total);
          var mcb = $('#manual-curation-progressbar');
          mcp.html(perc);
          mcb.css("width", "" + perc + "%");
          mcb.attr("aria-valuenow", perc);
        }
      })
      .fail(function(res) {
        alert(res["responseText"]);
      })
      .always(function() {
        dt.removeClass("bg-warning");
      });

      return(false);
    }
  );
</script>
